<html>

  <head>
    <meta charset="UTF-8">
    <title>Birdcage Builder v0.0.3</title>

    <!-- scripts must be included in reverse order of call stack for scope visibility -->
    <script src="debug.js"></script>
    <script src="helpers.js"></script>
    <script src="BCLegs.js"></script>
    <script src="BCEndRings.js"></script>
    <script src="BirdcageBuilder.js"></script>
    <script src="BBGuiHandler.js"></script>
    <script src="../../plotly/v1.58.5/plotly-latest.min.js"></script>



  <!-- Birdcage Builder -->
  <!-- Test known values from 2002 paper against Java & Android app code -->
  <!-- Doug Brantner 7/10/2023 -->
  <!-- NYU Langone Health CAI2R -->
  <!-- cai2r.net -->

  </head>





  <body>
    <h1>Birdcage Builder</h1>

    <h2>Java/Android Test Values</h2>

    <form> 
      <button type="submit" onclick="run_all(); return false">Run Tests</button>
      <!-- 'return false' is necessary to avoid automatic page refresh -->
    </form>

    <hr>
    <h2>Output</h2>

    <button type="submit" onclick="output_clear(); return false">Clear Results</button>

    <p id="output_test1">This field intentionally blank.</p>
    <p id="output_main"></p>
    <p id="output_csv_test"></p>



    <hr>
    <h2>Debug</h2>
    <form>
    <button type="submit" onclick="debug_clear(); return false">Clear Debug</button>
    </form>
    <p id="debug1"></p>
    <!-- TODO - add 'clear' button -->

    <hr>
    <h2>References</h2>
    1. <a href="https://en.wikipedia.org/wiki/Method_of_images">Method of Images</a><br>



    <script>
      // Java/Android tests (code copied & modified from Java JDK tests):
      // from PaperTests.java 7/10/2023

      // NOTE: this only tests the math workflow, not the complete GUI workflow
      // TODO see qunit_full_dom_tests.js  for full GUI/DOM tests


      function testcase(config, N, f, rc, rs, ll, lw, or, ir, erl, erw, c, tol, pc) {
       /*
        *  config = coil config (HP, LP, BP, etc.)
        *  N = number of legs
        *  f = target frequency
        *  rc = coil radius
        *  rs = shield radius
        *  ll = leg length
        *  lw = leg width (rect only)
        *  or, ir = leg outer/inner radius (tube only)
        *  erl = endring segment length (?) - override for values listed in paper (TODO NOT YET IMPLEMENTED!)
        *  erw = endring width
        *  c = expected capacitor value (from paper - calculated, not experimental)
        *  tol = tolerance for pass/fail of this test
        *  pc = predefined cap value for Bandpass (config 2/3 only)
        */

         f *= 1e6;
        rc *= 1e-2;
        rs *= 1e-2;
        ll *= 1e-2;
        lw *= 1e-2;
        or *= 1e-2;
        ir *= 1e-2;
        erl *= 1e-2;
        erw *= 1e-2;
        //c *= 1e-12;

            //config = 0 -> low-pass
            //config = 1 -> High-pass
            //config = 2 -> Band-pass, with cap on legs
            //config = 3 -> Band-pass, with cap on ER
        
        var js_config = 'unset';
        switch (config) {
          case 0:
            js_config = 'lowpass';
            break;
          case 1:
            js_config = 'highpass';
            break;
          case 2:
            js_config = 'bandpass_leg';
            break;
          case 3:
            js_config = 'bandpass_er';
            break;
          default:
            debug('Invalid config!');
            console.log('Invalid config!');
        }

        bb = new BirdcageBuilder(N, f, rc, rs, js_config);

        if (lw > 0) {
          // Rectangular Legs
		      bb.legs.set_legs_rect(ll, lw);
        }
        else {
          // assume tube legs
		      bb.legs.set_legs_tube(ll, ir, or);
        }

        // NOTE all endrings are rectangular in paper examples:
        // TODO modification required to test tube endring values
        bb.endrings.set_endrings_rect(erw);
        // TODO - also currently ignoring endring arclen mentioned in paper

	      bb.endrings.calc_er_mutual_inductance(bb.legs);


        if (config == 2 || config == 3) {
          if (pc < 0) {
            debug("ERROR: You must specify pc for bandpass case.\n");
          }
          bb.predcap = pc;
        }
        //bb.birdlegs.legcalc();
        //bb.birder.ERcomp();
        //bb.capcomp();

        var cap = bb.calc_capacitor(); // TODO compute pass/fail based on tol?
        // TODO javascript/java results should be comparable to full precisioN?
        // as opposed to the App which truncates/rounds to 4 decimal places

        var csv_results = bb.to_app_csv_string();

        document.getElementById("output_csv_test").innerHTML += csv_results;

      }

      function run_all() {

        document.getElementById("output_csv_test").innerHTML += 'A,';
        testcase(0, 12, 21.28, 3.8, 100, 10, 0.6, -1, -1, -1, 0.6, 268.6685, 0.5e-4);
        document.getElementById("output_csv_test").innerHTML += '<br>';

        //System.out.println("\nPaper Test B (nearest app Freq):");
        //System.out.print("B,");
        document.getElementById("output_csv_test").innerHTML += 'B,';
        testcase(0, 12, 63.85, 4.45, 0, 8.9, 0.6, -1, -1, -1, 0.6, 28.7601, 0.5e-4);
        document.getElementById("output_csv_test").innerHTML += '<br>';
        //System.out.println("\nPaper Test C:");
        //System.out.print("C,");
        document.getElementById("output_csv_test").innerHTML += 'C,';
        testcase(0, 8, 125.2, 6.35, 8.95, 12.6, 1.27, -1, -1, -1, 1.27, 8.8289, 0.5e-4);
        document.getElementById("output_csv_test").innerHTML += '<br>';
        
        //System.out.println("\nPaper Test D (nearest app Freq):");
        //System.out.print("D,");
        document.getElementById("output_csv_test").innerHTML += 'D,';
        testcase(0, 8, 400.1, 1.25, 1.87, 2.4, 0.1, -1, -1, -1, 0.1, 3.3765, 0.5e-4);
        document.getElementById("output_csv_test").innerHTML += '<br>';

        ////System.out.println("\nPaper Test E @ 85.13MHz (nearest app Freq, not close):");
        //System.out.print("E1,");
        document.getElementById("output_csv_test").innerHTML += 'E1,';
        testcase(1, 16, 85.13, 9.52, 35.5, 22.2, -1, 0.4, 0.3, -1, 1.3, 70.2500, 0.5e-4);
        document.getElementById("output_csv_test").innerHTML += '<br>';

        ////System.out.println("\nPaper Test E @ 125.2MHz (2nd nearest app Freq, also not close):");
        //System.out.print("E1,");
        document.getElementById("output_csv_test").innerHTML += 'E2,';
        testcase(1, 16, 125.20, 9.52, 35.5, 22.2, -1, 0.4, 0.3, -1, 1.3, 32.4790, 0.5e-4);
        document.getElementById("output_csv_test").innerHTML += '<br>';

        // NOT in app:
        ////System.out.println("\nPaper Test F:");
        //System.out.print("F,");
        document.getElementById("output_csv_test").innerHTML += 'F,';
        testcase(1, 12, 200.03, 9.7, 12.8, 20, -1, 0.65, 0.40, -1, 1.4, 11.62, 0.5e-3);
        document.getElementById("output_csv_test").innerHTML += '<br>';

        // the rest are bandpasses, with an extra argument at the end (unction overload)
        ////System.out.println("\nPaper Test G:");
        //System.out.print("G,");
        document.getElementById("output_csv_test").innerHTML += 'G,';
        testcase(1, 8, 200.03, 1.9, 50, 7.3, 0.6, -1, -1, -1, 0.6, 25.6702, 0.5e-3, 33);
        document.getElementById("output_csv_test").innerHTML += '<br>';

        ////System.out.println("\nPaper Test H:");
        //System.out.print("H,");
        document.getElementById("output_csv_test").innerHTML += 'H,';
        testcase(3, 12, 125.2, 9.5, 0.0, 20, 1.25, -1, -1, -1, 1.25, 15.04, 0.5e-3, 33);
        document.getElementById("output_csv_test").innerHTML += '<br>';

        ////System.out.println("\nPaper Test I (@ 125.2 MHz):");
        //System.out.print("I1,");
        document.getElementById("output_csv_test").innerHTML += 'I1,';
        testcase(2, 12, 125.2, 9.5, 0.0, 17.2, 0.6, -1, -1, -1, 0.5, 14.26, 0.5e-3, 11.7)    ;
        document.getElementById("output_csv_test").innerHTML += '<br>';

        ////System.out.println("\nPaper Test I (@ 200.03MHz):");
        //System.out.print("I2,");
        document.getElementById("output_csv_test").innerHTML += 'I2,';
        testcase(2, 12, 200.03, 9.5, 0.0, 17.2, 0.6, -1, -1, -1, 0.5, 14.26, 0.5e-3, 11.7    );
        document.getElementById("output_csv_test").innerHTML += '<br>';

        ////System.out.println("\nPaper Test J (@ 125.2 MHz):");
        //System.out.print("J1,");
        document.getElementById("output_csv_test").innerHTML += 'J1,';
        testcase(2, 12, 125.2, 8.4, 0.0, 22.5, 0.6, -1, -1, -1, 0.6, 11.62, 0.5e-3, 47);
        document.getElementById("output_csv_test").innerHTML += '<br>';

        //System.out.print("J2,");
        document.getElementById("output_csv_test").innerHTML += 'J2,';
        testcase(2, 12, 200.03, 8.4, 0.0, 22.5, 0.6, -1, -1, -1, 0.6, 11.62, 0.5e-3, 47);
        document.getElementById("output_csv_test").innerHTML += '<br>';


      /*
       //System.out.println("\nPaper Test A:");
       document.getElementById("output_csv_test").innerHTML += 'A,';
       testcase(0, 12, 21.25, 3.8, 100, 10, 0.6, -1, -1, -1, 0.6, 269.54, 0.5e-3);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test B:");
       document.getElementById("output_csv_test").innerHTML += 'B,';
       testcase(0, 12, 63, 4.45, 0, 8.9, 0.6, -1, -1, -1, 0.6, 29.56, 0.5e-3);
       document.getElementById("output_csv_test").innerHTML += '<br>';
  
       //System.out.println("\nPaper Test C:");
       document.getElementById("output_csv_test").innerHTML += 'C,';
       testcase(0, 8, 127.8, 6.35, 8.95, 12.6, 1.27, -1, -1, -1, 1.27, 9.76, 0.5e-3);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test D:");
       document.getElementById("output_csv_test").innerHTML += 'D,';
       testcase(0, 8, 400.1, 1.25, 1.87, 2.4, 0.1, -1, -1, -1, 0.1, 3.3, 0.5e-3);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test E:");
       //System.out.println("\nNOTE: App does not have a nearby frequency!)");
       document.getElementById("output_csv_test").innerHTML += 'E0,';
       testcase(1, 16, 106, 9.52, 35.5, 22.2, -1, 0.4, 0.3, -1, 1.3, 47.47, 0.5e-3);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test E @ 85.13MHz (nearest app Freq, not close):");
       document.getElementById("output_csv_test").innerHTML += 'E1,';
       testcase(1, 16, 85.13, 9.52, 35.5, 22.2, -1, 0.4, 0.3, -1, 1.3, 70.2500, 0.5e-4);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test E @ 125.2MHz (2nd nearest app Freq, also not close):");
       document.getElementById("output_csv_test").innerHTML += 'E2,';
       testcase(1, 16, 125.20, 9.52, 35.5, 22.2, -1, 0.4, 0.3, -1, 1.3, 32.4790, 0.5e-4);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test F:");
       document.getElementById("output_csv_test").innerHTML += 'F,';
       testcase(1, 12, 200.1, 9.7, 12.8, 20, -1, 0.65, 0.40, -1, 1.4, 11.62, 0.5e-3);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test G:");
       document.getElementById("output_csv_test").innerHTML += 'G,';
       testcase(1, 8, 200.5, 1.9, 50, 7.3, 0.6, -1, -1, -1, 0.6, 25.58, 0.5e-3);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test H:");
       document.getElementById("output_csv_test").innerHTML += 'H,';
       testcase(3, 12, 125.2, 9.5, 0.0, 20, 1.25, -1, -1, -1, 1.25, 15.04, 0.5e-3, 33);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test I:");
       document.getElementById("output_csv_test").innerHTML += 'I0,';
       testcase(2, 12, 170, 9.5, 0.0, 17.2, 0.6, -1, -1, -1, 0.5, 14.26, 0.5e-3, 11.7);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test I (@ 125.2 MHz):");
       document.getElementById("output_csv_test").innerHTML += 'I1,';
       testcase(2, 12, 125.2, 9.5, 0.0, 17.2, 0.6, -1, -1, -1, 0.5, 14.26, 0.5e-3, 11.7)    ;
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test I (@ 200.03MHz):"); 
       document.getElementById("output_csv_test").innerHTML += 'I2,';
       testcase(2, 12, 200.03, 9.5, 0.0, 17.2, 0.6, -1, -1, -1, 0.5, 14.26, 0.5e-3, 11.7    );
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test J0:");   
       document.getElementById("output_csv_test").innerHTML += 'J0,';
       testcase(2, 12, 173, 8.4, 0.0, 22.5, 0.6, -1, -1, -1, 0.6, 11.62, 0.5e-3, 47);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test J (@ 125.2 MHz):"); 
       document.getElementById("output_csv_test").innerHTML += 'J1,';
       testcase(2, 12, 125.2, 8.4, 0.0, 22.5, 0.6, -1, -1, -1, 0.6, 11.62, 0.5e-3, 47);
       document.getElementById("output_csv_test").innerHTML += '<br>';

       //System.out.println("\nPaper Test J (@ 200.03 MHz):");
       document.getElementById("output_csv_test").innerHTML += 'J2,';
       testcase(2, 12, 200.03, 8.4, 0.0, 22.5, 0.6, -1, -1, -1, 0.6, 11.62, 0.5e-3, 47);
       document.getElementById("output_csv_test").innerHTML += '<br>';
      */
 


      }



    </script>





  </body>


</html>
